<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>O(1) 时间插入、删除和获取随机元素</title>
    <link rel="stylesheet" href="../common.css" as="style" />
  </head>
  <body>
    <div class="elfjS" data-track-load="description_content">
      <p>实现<code>RandomizedSet</code> 类：</p>

      <div class="original__bRMd">
        <div>
          <ul>
            <li>
              <code>RandomizedSet()</code> 初始化
              <code>RandomizedSet</code> 对象
            </li>
            <li>
              <code>bool insert(int val)</code> 当元素
              <code>val</code> 不存在时，向集合中插入该项，并返回
              <code>true</code> ；否则，返回 <code>false</code> 。
            </li>
            <li>
              <code>bool remove(int val)</code> 当元素
              <code>val</code> 存在时，从集合中移除该项，并返回
              <code>true</code> ；否则，返回 <code>false</code> 。
            </li>
            <li>
              <code>int getRandom()</code>
              随机返回现有集合中的一项（测试用例保证调用此方法时集合中至少存在一个元素）。每个元素应该有
              <strong>相同的概率</strong> 被返回。
            </li>
          </ul>

          <p>
            你必须实现类的所有函数，并满足每个函数的
            <strong>平均</strong> 时间复杂度为 <code>O(1)</code> 。
          </p>

          <p>&nbsp;</p>

          <p><strong>示例：</strong></p>

          <pre><strong>输入</strong>
        ["RandomizedSet", "insert", "remove", "insert", "getRandom", "remove", "insert", "getRandom"]
        [[], [1], [2], [2], [], [1], [2], []]
        <strong>输出</strong>
        [null, true, false, true, 2, true, false, 2]
        
        <strong>解释</strong>
        RandomizedSet randomizedSet = new RandomizedSet();
        randomizedSet.insert(1); // 向集合中插入 1 。返回 true 表示 1 被成功地插入。
        randomizedSet.remove(2); // 返回 false ，表示集合中不存在 2 。
        randomizedSet.insert(2); // 向集合中插入 2 。返回 true 。集合现在包含 [1,2] 。
        randomizedSet.getRandom(); // getRandom 应随机返回 1 或 2 。
        randomizedSet.remove(1); // 从集合中移除 1 ，返回 true 。集合现在包含 [2] 。
        randomizedSet.insert(2); // 2 已在集合中，所以返回 false 。
        randomizedSet.getRandom(); // 由于 2 是集合中唯一的数字，getRandom 总是返回 2 。
        </pre>

          <p>&nbsp;</p>

          <p><strong>提示：</strong></p>

          <ul>
            <li>
              <code>-2<sup>31</sup> &lt;= val &lt;= 2<sup>31</sup> - 1</code>
            </li>
            <li>
              最多调用 <code>insert</code>、<code>remove</code> 和
              <code>getRandom</code> 函数 <code>2 *&nbsp;</code
              ><code>10<sup>5</sup></code> 次
            </li>
            <li>
              在调用 <code>getRandom</code> 方法时，数据结构中
              <strong>至少存在一个</strong> 元素。
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="analysis">
      <div class="FN9Jv WRmCx">
        <h4 id="方法一变长数组--哈希表">方法一：变长数组 + 哈希表</h4>
        <p>
          这道题要求实现一个类，满足插入、删除和获取随机元素操作的平均时间复杂度为
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord mathnormal" style="margin-right: 0.02778em"
                    >O</span
                  ><span class="mopen">(</span><span class="mord">1</span
                  ><span class="mclose">)</span></span
                ></span
              ></span
            ></span
          >。
        </p>
        <p>
          变长数组可以在
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord mathnormal" style="margin-right: 0.02778em"
                    >O</span
                  ><span class="mopen">(</span><span class="mord">1</span
                  ><span class="mclose">)</span></span
                ></span
              ></span
            ></span
          >
          的时间内完成获取随机元素操作，但是由于无法在
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord mathnormal" style="margin-right: 0.02778em"
                    >O</span
                  ><span class="mopen">(</span><span class="mord">1</span
                  ><span class="mclose">)</span></span
                ></span
              ></span
            ></span
          >
          的时间内判断元素是否存在，因此不能在
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord mathnormal" style="margin-right: 0.02778em"
                    >O</span
                  ><span class="mopen">(</span><span class="mord">1</span
                  ><span class="mclose">)</span></span
                ></span
              ></span
            ></span
          >
          的时间内完成插入和删除操作。哈希表可以在
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord mathnormal" style="margin-right: 0.02778em"
                    >O</span
                  ><span class="mopen">(</span><span class="mord">1</span
                  ><span class="mclose">)</span></span
                ></span
              ></span
            ></span
          >
          的时间内完成插入和删除操作，但是由于无法根据下标定位到特定元素，因此不能在
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord mathnormal" style="margin-right: 0.02778em"
                    >O</span
                  ><span class="mopen">(</span><span class="mord">1</span
                  ><span class="mclose">)</span></span
                ></span
              ></span
            ></span
          >
          的时间内完成获取随机元素操作。为了满足插入、删除和获取随机元素操作的时间复杂度都是
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord mathnormal" style="margin-right: 0.02778em"
                    >O</span
                  ><span class="mopen">(</span><span class="mord">1</span
                  ><span class="mclose">)</span></span
                ></span
              ></span
            ></span
          >，需要将变长数组和哈希表结合，变长数组中存储元素，哈希表中存储每个元素在变长数组中的下标。
        </p>
        <p>
          插入操作时，首先判断
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span class="strut" style="height: 0.6944em"></span
                  ><span class="mord text"
                    ><span class="mord textit">val</span></span
                  ></span
                ></span
              ></span
            ></span
          >
          是否在哈希表中，如果已经存在则返回
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span class="strut" style="height: 0.6944em"></span
                  ><span class="mord text"
                    ><span class="mord">false</span></span
                  ></span
                ></span
              ></span
            ></span
          >，如果不存在则插入
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span class="strut" style="height: 0.6944em"></span
                  ><span class="mord text"
                    ><span class="mord textit">val</span></span
                  ></span
                ></span
              ></span
            ></span
          >，操作如下：
        </p>
        <ol>
          <li>
            <p>
              在变长数组的末尾添加
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6944em"></span
                      ><span class="mord text"
                        ><span class="mord textit">val</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >；
            </p>
          </li>
          <li>
            <p>
              在添加
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6944em"></span
                      ><span class="mord text"
                        ><span class="mord textit">val</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >
              之前的变长数组长度为
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6944em"></span
                      ><span class="mord text"
                        ><span class="mord textit">val</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >
              所在下标
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6944em"></span
                      ><span class="mord text"
                        ><span class="mord textit">index</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >，将
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6944em"></span
                      ><span class="mord text"
                        ><span class="mord textit">val</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >
              和下标
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6944em"></span
                      ><span class="mord text"
                        ><span class="mord textit">index</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >
              存入哈希表；
            </p>
          </li>
          <li>
            <p>
              返回
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6151em"></span
                      ><span class="mord text"
                        ><span class="mord">true</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >。
            </p>
          </li>
        </ol>
        <p>
          删除操作时，首先判断
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span class="strut" style="height: 0.6944em"></span
                  ><span class="mord text"
                    ><span class="mord textit">val</span></span
                  ></span
                ></span
              ></span
            ></span
          >
          是否在哈希表中，如果不存在则返回
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span class="strut" style="height: 0.6944em"></span
                  ><span class="mord text"
                    ><span class="mord">false</span></span
                  ></span
                ></span
              ></span
            ></span
          >，如果存在则删除
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span class="strut" style="height: 0.6944em"></span
                  ><span class="mord text"
                    ><span class="mord textit">val</span></span
                  ></span
                ></span
              ></span
            ></span
          >，操作如下：
        </p>
        <ol>
          <li>
            <p>
              从哈希表中获得
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6944em"></span
                      ><span class="mord text"
                        ><span class="mord textit">val</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >
              的下标
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6944em"></span
                      ><span class="mord text"
                        ><span class="mord textit">index</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >；
            </p>
          </li>
          <li>
            <p>
              将变长数组的最后一个元素
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6944em"></span
                      ><span class="mord text"
                        ><span class="mord textit">last</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >
              移动到下标
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6944em"></span
                      ><span class="mord text"
                        ><span class="mord textit">index</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >
              处，在哈希表中将
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6944em"></span
                      ><span class="mord text"
                        ><span class="mord textit">last</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >
              的下标更新为
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6944em"></span
                      ><span class="mord text"
                        ><span class="mord textit">index</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >；
            </p>
          </li>
          <li>
            <p>
              在变长数组中删除最后一个元素，在哈希表中删除
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6944em"></span
                      ><span class="mord text"
                        ><span class="mord textit">val</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >；
            </p>
          </li>
          <li>
            <p>
              返回
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6151em"></span
                      ><span class="mord text"
                        ><span class="mord">true</span></span
                      ></span
                    ></span
                  ></span
                ></span
              >。
            </p>
          </li>
        </ol>
        <p>
          删除操作的重点在于将变长数组的最后一个元素移动到待删除元素的下标处，然后删除变长数组的最后一个元素。该操作的时间复杂度是
          <span class="math math-inline"
            ><span class="katex"
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="height: 1em; vertical-align: -0.25em"
                  ></span
                  ><span class="mord mathnormal" style="margin-right: 0.02778em"
                    >O</span
                  ><span class="mopen">(</span><span class="mord">1</span
                  ><span class="mclose">)</span></span
                ></span
              ></span
            ></span
          >，且可以保证在删除操作之后变长数组中的所有元素的下标都连续，方便插入操作和获取随机元素操作。
        </p>
        <p>
          获取随机元素操作时，由于变长数组中的所有元素的下标都连续，因此随机选取一个下标，返回变长数组中该下标处的元素。
        </p>
        <p><strong>复杂度分析</strong></p>
        <ul>
          <li>
            <p>
              时间复杂度：初始化和各项操作的时间复杂度都是
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 1em; vertical-align: -0.25em"
                      ></span
                      ><span
                        class="mord mathnormal"
                        style="margin-right: 0.02778em"
                        >O</span
                      ><span class="mopen">(</span><span class="mord">1</span
                      ><span class="mclose">)</span></span
                    ></span
                  ></span
                ></span
              >。
            </p>
          </li>
          <li>
            <p>
              空间复杂度：<span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 1em; vertical-align: -0.25em"
                      ></span
                      ><span
                        class="mord mathnormal"
                        style="margin-right: 0.02778em"
                        >O</span
                      ><span class="mopen">(</span
                      ><span class="mord mathnormal">n</span
                      ><span class="mclose">)</span></span
                    ></span
                  ></span
                ></span
              >，其中
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.4306em"></span
                      ><span class="mord mathnormal">n</span></span
                    ></span
                  ></span
                ></span
              >
              是集合中的元素个数。存储元素的数组和哈希表需要
              <span class="math math-inline"
                ><span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 1em; vertical-align: -0.25em"
                      ></span
                      ><span
                        class="mord mathnormal"
                        style="margin-right: 0.02778em"
                        >O</span
                      ><span class="mopen">(</span
                      ><span class="mord mathnormal">n</span
                      ><span class="mclose">)</span></span
                    ></span
                  ></span
                ></span
              >
              的空间。
            </p>
          </li>
        </ul>
      </div>
    </div>
    <script>
      var RandomizedSet = function () {
        this.nums = [];
        this.indices = new Map();
      };

      /**
       * @param {number} val
       * @return {boolean}
       */
      RandomizedSet.prototype.insert = function (val) {
        if (this.indices.has(val)) return false;
        let index = this.nums.length;
        this.nums.push(val);
        this.indices.set(val, index);
        // this.indices.set(val, val);
        return true;
      };

      /**
       * @param {number} val
       * @return {boolean}
       */
      RandomizedSet.prototype.remove = function (val) {
        if (!this.indices.has(val)) return false;
        // let id = this.indices.get(val);
        // this.nums.splice(this.nums.indexOf(id), 1)
        // 删除操作的重点在于将变长数组的最后一个元素移动到待删除元素的下标处，然后删除变长数组的最后一个元素。
        // 该操作的时间复杂度是 O(1)，且可以保证在删除操作之后变长数组中的所有元素的下标都连续，方便插入操作和获取随机元素操作
        // this.nums = [1, 2, 3, 4]
        let id = this.indices.get(val); // id 2
        this.nums[id] = this.nums[this.nums.length - 1]; // this.nums = [1, 4, 3, 4] 相当于把 最后的元素值 复制到了 删除的元素下标上
        this.indices.set(this.nums[id], id); // 此时记录下替换后元素的位置
        this.nums.pop(); // 最后删除最后一个元素，等于删除了 2 
        this.indices.delete(val);
        // this.nums = [1, 2, 3, 4]  id 2  {1 => 0, 2 => 1, 3 => 2, 4 => 3}
        // this.nums = [1, 4, 3]  id 2  {1 => 0, 3 => 2, 4 => 1}
        console.log('this.nums: ', this.nums);
        console.log('this.indices: ', this.indices);
        return true;
      };

      /**
       * @return {number}
       */
      RandomizedSet.prototype.getRandom = function () {
        const randomIndex = Math.floor(Math.random() * this.nums.length);
        return this.nums[randomIndex];
      };

      /**
       * Your RandomizedSet object will be instantiated and called as such:
       * var obj = new RandomizedSet()
       * var param_1 = obj.insert(val)
       * var param_2 = obj.remove(val)
       * var param_3 = obj.getRandom()
       */
      //   const nums = [3, 0, 6, 1, 5];
      const list = [
        "RandomizedSet",
        "insert",
        "insert",
        "insert",
        "insert",
        "remove",
        "insert",
        "getRandom",
        "remove",
        "insert",
        "getRandom",
      ];
      const values = [[], [1], [2], [3], [4], [2], [5], [], [1], [2], []];
      const getRandomizedSetResult = function (list, values) {
        let RandomizedSetClass = null;
        const result = [];
        for (const i in list) {
          const item = list[i];
          if (item === "RandomizedSet") {
            RandomizedSetClass = new RandomizedSet();
            result.push(null);
          } else {
            if (item === "getRandom") {
              result.push(RandomizedSetClass[item]());
            } else {
              result.push(RandomizedSetClass[item](values[i]?.[0]));
            }
          }
        }
        return result
      };
      const result = getRandomizedSetResult(list, values)
      console.log("result: ", result);
    </script>
  </body>
</html>
